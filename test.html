<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGS Trig Test</title>
</head>
<body>
  <h2>CGS Lookup Test</h2>

  <input type="text" id="inputExpr" placeholder="cos(0.524)" />
  <button id="calc">Calculate</button>
  <p id="output"></p>

  <script>
    let trig = {};

    // Load trig.json dynamically
    fetch('trig.json')
      .then(res => res.json())
      .then(data => {
        trig = data;
      });

    function findClosestRad(x, funcType) {
      let closestKey = null;
      let minDiff = Infinity;

      for (const key in trig) {
        if (!trig[key][funcType]) continue;
        const match = key.match(/rad\\(([^)]+)\\)/);
        if (!match) continue;

        const rad = parseFloat(match[1]);
        const diff = Math.abs(rad - x);
        if (diff < minDiff) {
          minDiff = diff;
          closestKey = key;
        }
      }

      if (closestKey) {
        const val = trig[closestKey][funcType].value?.approx ?? trig[closestKey][funcType].value;
        return `${funcType}(${closestKey}) ≈ ${val}`;
      }

      return 'No match found';
    }

    function queryCos(input) {
      const match = input.match(/cos\\s*\\(?([0-9.]+)\\)?/i);
      if (!match) return 'Invalid format';

      const x = parseFloat(match[1]);
      const key = `rad(${x.toFixed(3)})`;

      if (trig[key]?.cos) {
        const val = trig[key].cos.value?.approx ?? trig[key].cos.value;
        return `cos(${x}) ≈ ${val}`;
      }

      if (x > 0.8 || x < 0.1) {
        return `cos(${x}) ≈ ${findClosestRad(x, 'cos')}`;
      }

      if (x > 0.1 && x < 0.8) {
        const refl = (1.6 - x).toFixed(3);
        const reflKey = `rad(${refl})`;
        if (trig[reflKey]?.sin) {
          const val = trig[reflKey].sin.value?.approx ?? trig[reflKey].sin.value;
          return `cos(${x}) ≈ sin(${refl}) ≈ ${val}`;
        }

        return `cos(${x}) ≈ sin(${refl}) ≈ ${findClosestRad(parseFloat(refl), 'sin')}`;
      }

      return 'Out of supported range';
    }

    document.getElementById('calc').addEventListener('click', () => {
      const expr = document.getElementById('inputExpr').value;
      const result = queryCos(expr);
      document.getElementById('output').textContent = result;
    });
  </script>
</body>
</html>
